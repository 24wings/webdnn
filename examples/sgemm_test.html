<title>computeCommand with WebGPU : sgemm</title>

Open Debug Console and Run <code>main()</code> Function.

<script src="./gpgpu.js"></script>
<script src="./webgpublas.js"></script>
<script>
    let BLAS;

    async function main() {
        if (!GPGPU.isBrowserSupported) {
            console.warn('WebGPURenderingContext is not supported in this browser.');
            return;
        }

        gpu = new GPGPU();
        BLAS = await initWebGPUBLAS(gpu);

        const M = 128;
        const N = 1024;
        const K = 4096;
        const alpha = 1.0;
        const beta = 0.0;

        let A = new Float32Array(M * K);
        let B = new Float32Array(K * N);
        let C1 = gpu.createBuffer(new Float32Array(M * N));
        let C2 = gpu.createBuffer(new Float32Array(M * N));

        for (let i = 0; i < A.length; i++) A[i] = i;
        for (let i = 0; i < B.length; i++) B[i] = i;
        for (let i = 0; i < C1.length; i++) C1.contents[i] = i;
        for (let i = 0; i < C2.length; i++) C2.contents[i] = i;

        await BLAS.sync();

        console.log('sgemm');
        BLAS.sgemm(M, N, K, alpha, A, B, beta, C1);

        await BLAS.sync();

        console.log('sgemm(naive)');
        BLAS.sgemmNaive(M, N, K, alpha, A, B, beta, C2);

        await BLAS.sync();

        C1 = new Float32Array(C1.contents);
        C2 = new Float32Array(C2.contents);

        console.log('compare');

        let flagFailed = false;
        for (let m = 0; m < M; m++) {
            for (let n = 0; n < N; n++) {
                if (Math.abs(C1[n * M + m] - C2[n * M + m]) / (C1[n * M + m] + 1e-9) < 0.01) continue;

                console.log(`ERROR: C1[${m}, ${n}]=${C1[n*M+m]}, C2[${m}, ${n}]=${C2[n*M+m]}`);
                flagFailed = true;
                break;
            }
            if (flagFailed) break;
        }

        if (!flagFailed) {
            console.log('SUCCESS');
        }
    }
</script>