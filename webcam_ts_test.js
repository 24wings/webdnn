!function(e){function t(a){if(i[a])return i[a].exports;var n=i[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,a){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="https://mil-tokyo.github.io/webdnn",t(t.s=13)}({13:function(e,t,i){"use strict";function a(e){var t=document.getElementById(e);if(!t)throw Error("#"+e+" is not found.");return t}var n=this&&this.__awaiter||function(e,t,i,a){return new(i||(i=Promise))(function(n,r){function s(e){try{l(a.next(e))}catch(e){r(e)}}function o(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){e.done?n(e.value):new i(function(t){t(e.value)}).then(s,o)}l((a=a.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function i(e){return function(t){return a([e,t])}}function a(i){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(s=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,r=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){l.label=i[1];break}if(6===i[0]&&l.label<s[1]){l.label=s[1],s=i;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(i);break}s[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,r,s,o,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o};Object.defineProperty(t,"__esModule",{value:!0});var s=i(2),o=new(function(){function e(){}return e.prototype.initialize=function(){return n(this,void 0,void 0,function(){var e,t=this;return r(this,function(i){return e=a("activateButton"),e.addEventListener("click",function(e){return t.onActivateButtonClick(e)}),[2]})})},e.prototype.onActivateButtonClick=function(e){return n(this,void 0,void 0,function(){var e;return r(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.initializeCameraAsync("#previewContainer")];case 1:return t.sent(),[3,3];case 2:return e=t.sent(),console.error(e),[3,3];case 3:return[2]}})})},e.prototype.initializeCameraAsync=function(e){var t=new s.default({width:192,height:144,fps:60,imageFormat:"png",flagForceFlash:!1,swfURL:"/webdnn/webcam.swf"});return this.webcam=t,t.attachAsync(e)},e}());window.onload=function(){o.initialize()}},2:function(e,t,i){"use strict";function a(e){var t=e.getContext("2d");if(!t)throw new Error("CanvasRenderingContext2D initialization failed.");return t}function n(){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?c=function(e){return navigator.mediaDevices.getUserMedia(e)}:"mozGetUserMedia"in navigator?c=function(e){return navigator.mozGetUserMedia(e)}:"webkitGetUserMedia"in navigator&&(c=function(e){return navigator.webkitGetUserMedia(e)}),"URL"in window?d=window.URL:"webkitURL"in window?d=window.webkitURL:"mozURL"in window?d=window.mozURL:"msURL"in window&&(d=window.msURL),navigator.userAgent.match(/Firefox\D+(\d+)/)&&parseInt(RegExp.$1,10)<21&&(c=null),"object"==typeof navigator.plugins&&"object"==typeof navigator.plugins[u]&&navigator.plugins[u].description&&"object"==typeof navigator.mimeTypes&&navigator.mimeTypes[p]&&navigator.mimeTypes[p].enabledPlugin)y=!0;else if("ActiveXObject"in window)try{var e=new window.ActiveXObject(f);e&&e.GetVariable("$version")&&(y=!0)}catch(e){}w=!0}function r(e){var t=new DataView(e);if(255!=t.getUint8(0)||216!=t.getUint8(1))return console.log("Not a valid JPEG file"),0;for(var i=2;i<e.byteLength;){if(255!=t.getUint8(i))return console.log("Not a valid marker at offset "+i+", found: "+t.getUint8(i)),0;if(225==t.getUint8(i+1)){i+=4;for(var a="",n=0;n<4;n++)a+=String.fromCharCode(t.getUint8(i+n));if("Exif"!=a)return console.log("Not valid EXIF data found"),0;i+=6;var r=null;if(18761==t.getUint16(i))r=!1;else{if(19789!=t.getUint16(i))return console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),0;r=!0}if(42!=t.getUint16(i+2,!r))return console.log("Not valid TIFF data! (no 0x002A)"),0;var s=t.getUint32(i+4,!r);if(s<8)return console.log("Not valid TIFF data! (First offset less than 8)",t.getUint32(i+4,!r)),0;for(var o=i+s,l=t.getUint16(o,!r),h=0;h<l;h++){var c=o+12*h+2;if(274==t.getUint16(c,!r)){var d=t.getUint16(c+2,!r),u=t.getUint32(c+4,!r);if(3!=d&&1!=u)return console.log("Invalid EXIF orientation value type ("+d+") or count ("+u+")"),0;var f=t.getUint16(c+8,!r);return f<1||f>8?(console.log("Invalid EXIF orientation value ("+f+")"),0):f}}}else i+=2+t.getUint16(i+2)}return 0}function s(e,t,i){var a=new Image;a.addEventListener("load",function(){var e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw Error("null");switch(t<5?(e.width=a.width,e.height=a.height):(e.width=a.height,e.height=a.width),t){case 2:n.transform(-1,0,0,1,a.width,0);break;case 3:n.transform(-1,0,0,-1,a.width,a.height);break;case 4:n.transform(1,0,0,-1,0,a.height);break;case 5:n.transform(0,1,1,0,0,0);break;case 6:n.transform(0,1,-1,0,a.height,0);break;case 7:n.transform(0,-1,-1,0,a.height,a.width);break;case 8:n.transform(0,-1,1,0,0,a.width)}n.drawImage(a,0,0),i.src=e.toDataURL()},!1),a.src=e}var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function a(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),l=this&&this.__awaiter||function(e,t,i,a){return new(i||(i=Promise))(function(n,r){function s(e){try{l(a.next(e))}catch(e){r(e)}}function o(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){e.done?n(e.value):new i(function(t){t(e.value)}).then(s,o)}l((a=a.apply(e,t||[])).next())})},h=this&&this.__generator||function(e,t){function i(e){return function(t){return a([e,t])}}function a(i){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(s=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,r=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){l.label=i[1];break}if(6===i[0]&&l.label<s[1]){l.label=s[1],s=i;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(i);break}s[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,r,s,o,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o};Object.defineProperty(t,"__esModule",{value:!0});var c,d,u="Shockwave Flash",f="ShockwaveFlash.ShockwaveFlash",p="application/x-shockwave-flash",m=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t}(Error),v=location.protocol.match(/https/i)?"https":"http",g=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),w=!1,y=!1,b={width:0,height:0,destWidth:0,destHeight:0,imageFormat:"png",jpegQuality:90,flagFlashEnable:!0,flagForceFlash:!1,fps:30,constraints:null,swfURL:"",flagUnfreezeSnap:!0},F=function(){function e(e){var t=this;this.$container=null,this.$peg=null,this.$previewCanvas=null,this.previewContext=null,this.$video=null,this.flagFlashMovieLoaded=!1,this.flagFlashLive=!1,this.flagUseUserMedia=!1,w||n(),this.params=Object.assign({},b,e),this.flagUserMedia=!this.params.flagForceFlash&&!!c&&!!window.URL,this.flagUserMedia&&(this.onBeforeUnload=function(){return t.reset()},window.addEventListener("beforeunload",this.onBeforeUnload))}return e.prototype.attachAsync=function(e){return l(this,void 0,void 0,function(){var t,i,a,n,o,l,u,f,p,m,v,w=this;return h(this,function(h){switch(h.label){case 0:if("string"==typeof e&&(e=document.querySelector(e)),!e)throw new Error("Could not locate DOM element to attach to.");if(this.$container=e,this.$container.innerHTML="",t=document.createElement("div"),e.appendChild(t),this.$peg=t,this.params.width||(this.params.width=e.offsetWidth),this.params.height||(this.params.height=e.offsetHeight),!this.params.width||!this.params.height)throw new Error("No width and/or height for webcam.  Please call set() first, or attach to a visible element.");if(this.params.destWidth||(this.params.destWidth=this.params.width),this.params.destHeight||(this.params.destHeight=this.params.height),"number"!=typeof this.params.fps&&(this.params.fps=30),i=this.params.width/this.params.destWidth,a=this.params.height/this.params.destHeight,!this.flagUserMedia||this.params.flagForceFlash)return[3,6];n=document.createElement("video"),n.setAttribute("autoplay","autoplay"),n.style.width=this.params.destWidth+"px",n.style.height=this.params.destHeight+"px",1==i&&1==a||(this.$container.style.overflow="hidden",n.style.transformOrigin="0px 0px",n.style.transform="scaleX("+i+") scaleY("+a+")"),this.$video=n,this.$container.appendChild(n),h.label=1;case 1:return h.trys.push([1,4,,5]),[4,c({audio:!1,video:!0})];case 2:return o=h.sent(),[4,new Promise(function(e,t){n.addEventListener("loadedmetadata",function(){w.flagFlashMovieLoaded=!0,w.flagFlashLive=!0,e()}),n.addEventListener("error",function(e){return t(e)}),n.srcObject=o})];case 3:return[2,h.sent()];case 4:if(l=h.sent(),this.$container&&y)return console.warn("This browser supports WebRTC, but initialization is failed."),console.warn(l),console.warn("WebCam.ts retries initialization with flash fallback."),this.params.flagForceFlash=!0,[2,this.attachAsync(this.$container)];throw l;case 5:return[3,10];case 6:return g?(u=document.createElement("div"),u.id=this.$container.id+"-ios_div",u.style.width=this.params.width+"px",u.style.height=this.params.height+"px",u.style.textAlign="center",u.style.display="table-cell",u.style.verticalAlign="middle",u.style.backgroundRepeat="no-repeat",u.style.backgroundSize="contain",u.style.backgroundPosition="center",f=document.createElement("span"),f.id=this.$container.id+"-ios_span",f.innerHTML="Tap here to open camera.",u.appendChild(f),p=document.createElement("img"),p.id=this.$container.id+"-ios_$img",p.style.width=this.params.destWidth+"px",p.style.height=this.params.destHeight+"px",p.style.display="none",u.appendChild(p),m=document.createElement("input"),m.id=this.$container.id+"-ios_$input",m.setAttribute("type","file"),m.setAttribute("accept","image/*"),m.setAttribute("capture","camera"),m.addEventListener("change",function(){if(m&&m.files&&m.files.length>0&&0==m.files[0].type.indexOf("image/")){var e=d.createObjectURL(m.files[0]),t=new Image;t.addEventListener("load",function(){var e=document.createElement("canvas");e.width=w.params.destWidth,e.height=w.params.destHeight;var i=e.getContext("2d");if(!i)throw Error("Canvas initialization is failed.");var a=Math.min(t.width/w.params.destWidth,t.height/w.params.destHeight),n=w.params.destWidth*a,r=w.params.destHeight*a,s=(t.width-n)/2,o=(t.height-r)/2;i.drawImage(t,s,o,n,r,0,0,w.params.destWidth,w.params.destHeight);var l=e.toDataURL();p.src=l,u.style.backgroundImage="url('"+l+"')"},!1);var i=new FileReader;i.addEventListener("load",function(){var a=r(i.result);a>1?s(e,a,t):t.src=e},!1);var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="blob",a.onload=function(){200!=a.status&&0!==a.status||i.readAsArrayBuffer(a.response)},a.send()}},!1),m.style.display="none",e.appendChild(m),u.addEventListener("click",function(){m.style.display="block",m.focus(),m.click(),m.style.display="none"},!1),e.appendChild(u),this.flagFlashMovieLoaded=!0,this.flagFlashLive=!0,[3,10]):[3,7];case 7:return this.params.flagFlashEnable&&y?(window.Webcam=this,v=document.createElement("div"),[4,new Promise(function(e,t){w.onFlashLive=function(){w.onFlashLive=w.onFlashError=null,e()},w.onFlashError=function(e){w.onFlashLive=w.onFlashError=null,t(e)},v.innerHTML=w.getSWFHTML(),w.$container.appendChild(v)})]):[3,9];case 8:return[2,h.sent()];case 9:throw new Error("No WebCam interface is detected.");case 10:return e.style.width=this.params.width+"px",e.style.height=this.params.height+"px",[2]}})})},e.prototype.reset=function(){if(this.flagPreviewIsActive&&this.unfreeze(),this.flagUseUserMedia&&(this.$video=null),this.flagUseUserMedia&&this.flagFlashMovieLoaded&&!g){var e=this.getMovie();e&&"_releaseCamera"in e&&e._releaseCamera()}this.$container&&(this.$container.innerHTML="",this.$container=null),this.flagFlashMovieLoaded=!1,this.flagFlashLive=!1},e.prototype.getSWFHTML=function(){var e=this;if(!y)throw new m("Adobe Flash Player not found. Please install from get.adobe.com/flashplayer and try again.");var t=Object.keys(this.params).map(function(t){return t+"="+encodeURIComponent(e.params[t])}).join("&");return'<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" type="application/x-shockwave-flash" codebase="'+v+'://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+this.params.width+'" height="'+this.params.height+'" id="webcam_movie_obj" align="middle"><param name="wmode" value="opaque" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+this.params.swfURL+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+t+'" /><embed id="webcam_movie_embed" src="'+this.params.swfURL+'" wmode="opaque" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+this.params.width+'" height="'+this.params.height+'" name="webcam_movie_embed" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+t+'"></embed></object>'},e.prototype.getMovie=function(){if(!this.flagFlashMovieLoaded)throw new m("Flash Movie is not loaded yet");var e;if(e=document.getElementById("webcam_movie_obj"),e&&e._snap||(e=document.getElementById("webcam_movie_embed")),!e)throw new m("Cannot locate Flash movie in DOM");return e},e.prototype.freezeAsync=function(){return l(this,void 0,void 0,function(){var e,t,i,n,r,s,o,l,d,u=this;return h(this,function(h){switch(h.label){case 0:if(!this.$container)throw new Error("$container is null.");if(this.flagPreviewIsActive&&this.unfreeze(),this.$previewCanvas?e=this.$previewCanvas:(t=this.params.destWidth,i=this.params.destHeight,e=document.createElement("canvas"),e.width=t,e.height=i,n=this.params.width/this.params.destWidth,r=this.params.height/this.params.destHeight,1==n&&1==r||(e.style.transformOrigin="0px 0px",e.style.transform="scaleX("+n+") scaleY("+r+")"),this.$previewCanvas=e),!c)return[3,1];if(!this.$video)throw Error("video is null");return a(this.$previewCanvas).drawImage(this.$video,0,0,this.params.destWidth,this.params.destHeight),[3,7];case 1:if(!g)return[3,5];if(!this.$container)throw Error("Not initialized yet");if(s=document.getElementById(this.$container.id+"-ios_div"),o=document.getElementById(this.$container.id+"-ios_input"),l=document.getElementById(this.$container.id+"-ios_img"),!s||!l||!o)throw Error("null");return o.value?[3,3]:[4,new Promise(function(t,i){l.onload=function(){a(e).drawImage(l,0,0,u.params.destWidth,u.params.destHeight),t()},l.onerror=function(e){return i(e)},o.style.display="block",o.focus(),o.click(),o.style.display="none",s.style.backgroundImage="none",l.removeAttribute("src"),o.value=""})];case 2:return h.sent(),[3,4];case 3:a(e).drawImage(l,0,0,this.params.destWidth,this.params.destHeight),s.style.backgroundImage="none",l.removeAttribute("src"),o.value="",h.label=4;case 4:return[3,7];case 5:return d=new Image,[4,new Promise(function(t,i){d.onload=function(){a(e).drawImage(d,0,0,u.params.destWidth,u.params.destHeight),t()},d.onerror=function(e){return i(e)},d.src="data:image/png;base64,"+u.getMovie()._snap()})];case 6:h.sent(),h.label=7;case 7:return this.$previewCanvas.style.position="relative",this.$previewCanvas.style.left=this.$container.scrollLeft+"px",this.$previewCanvas.style.top=this.$container.scrollTop+"px",this.$container.insertBefore(this.$previewCanvas,this.$peg),this.$container.style.overflow="hidden",this.flagPreviewIsActive=!0,[2]}})})},e.prototype.unfreeze=function(){this.flagPreviewIsActive&&(this.$container&&this.$previewCanvas&&this.$container.removeChild(this.$previewCanvas),this.previewContext=null,this.$previewCanvas=null,this.flagPreviewIsActive=!1)},e.prototype.snapAsync=function(e){return l(this,void 0,void 0,function(){return h(this,function(t){switch(t.label){case 0:if(!this.flagFlashMovieLoaded)throw new Error("Webcam is not loaded yet");return this.flagPreviewIsActive?[3,2]:[4,this.freezeAsync()];case 1:t.sent(),t.label=2;case 2:if(!this.$previewCanvas)throw new Error("PreviewCanvas is null");return a(e).drawImage(this.$previewCanvas,0,0),this.params.flagFleezeWhenSnapped||this.unfreeze(),[2]}})})},e.prototype.flashNotify=function(e,t){switch(e){case"flashLoadComplete":this.flagFlashMovieLoaded=!0;break;case"cameraLive":this.flagFlashLive=!0,this.onFlashLive&&this.onFlashLive();break;case"error":this.onFlashError&&this.onFlashError(new m(t))}},e}();t.default=F}});